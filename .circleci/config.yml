version: 2.1
orbs:
  codecov: codecov/codecov@1.0.2
jobs:
  build:
    machine: true
    steps:
      - checkout
      - run:
          name: Generate dummy data
          command: 
            echo -e "x,y,z,w,cat\n4.0,12.0,11.1,16.2,0\n22.0,14.9,13.2,13.3,0\n11.2,45.2,34.6,76.4,1\n56.7,8.7,1.34,13.2,1\n13.3,11.2,16.2,22.0,0\n14.9,13.2,88.9,10.4,1\n12.0,11.1,16.2,76.4,0\n1.34,13.2,13.3,76.4,0" > ./data.csv;
      - run:
          name: Pull xd009642/tarpaulin
          command: docker pull xd009642/tarpaulin
      - run:
          name: Generate coverage report
          command: >-
            docker run --security-opt seccomp=unconfined
            -v $PWD:/volume xd009642/tarpaulin
            cargo tarpaulin --out Xml --all-features
      - codecov/upload:
          file: cobertura.xml